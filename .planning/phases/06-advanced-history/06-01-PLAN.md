---
phase: 06-advanced-history
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/HistoryActions.tsx
  - components/HistoryCard.tsx
autonomous: true
requirements:
  - HIST-08
  - UIUX-03

must_haves:
  truths:
    - "User can type in search box and history list filters instantly by video title"
    - "User can type in search box and history list filters instantly by video URL"
    - "Search with no matches shows a clear empty state with 'clear search' link"
    - "Clearing search restores the full transcript list"
    - "Search and selection mode coexist: selectAll targets only visible (filtered) items"
  artifacts:
    - path: "components/HistoryActions.tsx"
      provides: "Search input with icon, client-side filtering via useMemo, search empty state"
      contains: "useMemo"
    - path: "components/HistoryCard.tsx"
      provides: "Polished card layout with consistent spacing and visual hierarchy"
  key_links:
    - from: "components/HistoryActions.tsx"
      to: "components/HistoryCard.tsx"
      via: "filteredTranscripts passed to HistoryCard rendering loop"
      pattern: "filteredTranscripts\\.map"
---

<objective>
Add instant client-side search filtering to the history page and polish the card layout.

Purpose: Users with many saved transcripts need to quickly find specific ones by title or URL without waiting for a server round-trip. Card polish improves visual hierarchy and readability.
Output: Updated HistoryActions with search input and filtering, updated HistoryCard with spacing refinements.
</objective>

<execution_context>
@/Users/jakesimpson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jakesimpson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@components/HistoryActions.tsx
@components/HistoryCard.tsx
@components/ui/input.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add search filtering to HistoryActions</name>
  <files>components/HistoryActions.tsx</files>
  <action>
Add client-side search filtering to the existing HistoryActions component:

1. Add imports: `useMemo` from react, `Search` from lucide-react, `Input` from `@/components/ui/input`.

2. Add state: `const [searchTerm, setSearchTerm] = useState("")`.

3. Add filtered list via useMemo:
```typescript
const filteredTranscripts = useMemo(() => {
  if (!searchTerm.trim()) return transcripts;
  const term = searchTerm.toLowerCase();
  return transcripts.filter(
    (t) =>
      t.videoTitle.toLowerCase().includes(term) ||
      t.videoUrl.toLowerCase().includes(term)
  );
}, [transcripts, searchTerm]);
```

4. Add search input above the selection toolbar (before the `<div className="flex items-center justify-between">` block):
```tsx
<div className="relative">
  <Search className="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground" />
  <Input
    placeholder="Search transcripts..."
    value={searchTerm}
    onChange={(e) => setSearchTerm(e.target.value)}
    className="pl-9"
  />
</div>
```

5. Update the transcript rendering loop: replace `transcripts.map` with `filteredTranscripts.map`.

6. Update `selectAll` to target only visible items: `setSelected(new Set(filteredTranscripts.map((t) => t.id)))` instead of all transcripts.

7. Add search empty state after the toolbar, before the transcript list. When `filteredTranscripts.length === 0` and `searchTerm.trim()` is non-empty, show:
```tsx
<div className="flex flex-col items-center justify-center gap-2 py-16 text-center">
  <p className="text-muted-foreground">
    No transcripts match &ldquo;{searchTerm}&rdquo;
  </p>
  <button
    onClick={() => setSearchTerm("")}
    className="text-sm text-primary underline underline-offset-4"
  >
    Clear search
  </button>
</div>
```
Only render the transcript map block when `filteredTranscripts.length > 0` or when `searchTerm` is empty (to avoid showing both empty state and empty list).

8. Do NOT add debouncing or useDeferredValue -- instant filtering is sufficient for expected list sizes under 200.
  </action>
  <verify>Run `npm run build` -- no type errors, no build failures. Verify HistoryActions imports useMemo and Search, has searchTerm state, filteredTranscripts memo, search Input in JSX, and updated selectAll.</verify>
  <done>Search input appears above the history list. Typing filters transcripts by title or URL instantly. Empty search state shows when no matches. SelectAll targets only visible items.</done>
</task>

<task type="auto">
  <name>Task 2: Polish HistoryCard layout</name>
  <files>components/HistoryCard.tsx</files>
  <action>
Refine the HistoryCard layout for consistent spacing and visual hierarchy (UIUX-03):

1. Ensure the card has consistent gap between thumbnail and content. The current `gap-4` in CardContent is fine.

2. Add a subtle border-bottom or separator between the text preview and the action row. Use `border-t border-border/50` on the action row div for a light divider.

3. Ensure the title uses `text-foreground` explicitly for contrast consistency across themes.

4. Ensure the preview text color is `text-muted-foreground` (already is, confirm).

5. Add `group` class to the Card and use `group-hover:text-foreground` on the title for a subtle hover effect on the title text.

Keep changes minimal -- the card already works well. This is visual polish, not a redesign. Do NOT change the card's overall structure or the action buttons.
  </action>
  <verify>Run `npm run build` -- no type errors. Visually inspect: card has clear title/preview/metadata hierarchy, subtle divider before actions, hover effect on title.</verify>
  <done>HistoryCard has polished spacing, visual hierarchy with divider, and hover enhancement on title.</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. Search input visible on /history page above transcript list
3. Typing in search filters by title and URL (case-insensitive)
4. Empty search results show "No transcripts match" message with clear link
5. Clearing search restores full list
6. Selection mode + search coexist: "Select All" targets only filtered items
7. Cards show polished layout with visual hierarchy
</verification>

<success_criteria>
History page has instant search filtering by title/URL with differentiated empty state. Cards have polished visual hierarchy. Selection mode correctly targets only visible (filtered) transcripts when using Select All.
</success_criteria>

<output>
After completion, create `.planning/phases/06-advanced-history/06-01-SUMMARY.md`
</output>
